
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../consume-events/">
      
      
        <link rel="next" href="../environments/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.17">
    
    
      
        <title>Producing Events - VA | Enterprise Event Bus</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
      
  
  
    
    
  
  
  <style>:root{--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22m14.6%2016.6%204.6-4.6-4.6-4.6L16%206l6%206-6%206zm-5.2%200L4.8%2012l4.6-4.6L8%206l-6%206%206%206z%22/%3E%3C/svg%3E');}</style>



    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#producing-events" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="VA | Enterprise Event Bus" class="md-header__button md-logo" aria-label="VA | Enterprise Event Bus" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            VA | Enterprise Event Bus
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Producing Events
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="VA | Enterprise Event Bus" class="md-nav__button md-logo" aria-label="VA | Enterprise Event Bus" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    VA | Enterprise Event Bus
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../intro-to-eda/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    How Event Bus Implements Event-driven Architecture
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../administrative-requirements/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Start Guide and Administrative Requirements
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../consume-events/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Consuming Events
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Producing Events
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Producing Events
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#whats-a-producer" class="md-nav__link">
    <span class="md-ellipsis">
      What's a producer?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#steps-to-become-a-producer" class="md-nav__link">
    <span class="md-ellipsis">
      Steps to become a producer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Steps to become a producer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#define-the-event-or-topic" class="md-nav__link">
    <span class="md-ellipsis">
      Define the event or topic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#determine-if-you-need-an-esecc-request" class="md-nav__link">
    <span class="md-ellipsis">
      Determine if you need an ESECC request
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#choose-configuration-settings-and-submit-onboarding-request" class="md-nav__link">
    <span class="md-ellipsis">
      Choose configuration settings and submit onboarding request
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Choose configuration settings and submit onboarding request">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#number-of-partitions" class="md-nav__link">
    <span class="md-ellipsis">
      Number of partitions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-retention" class="md-nav__link">
    <span class="md-ellipsis">
      Event retention
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-schema-and-event-registry" class="md-nav__link">
    <span class="md-ellipsis">
      Event schema and event registry
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-up-authorization-and-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      Set up authorization and authentication
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connect-to-the-event-bus-in-the-development-environment" class="md-nav__link">
    <span class="md-ellipsis">
      Connect to the Event Bus in the development environment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#develop-and-deploy-your-producer-application" class="md-nav__link">
    <span class="md-ellipsis">
      Develop and deploy your producer application
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Develop and deploy your producer application">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#client-properties" class="md-nav__link">
    <span class="md-ellipsis">
      Client properties
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#code-samples" class="md-nav__link">
    <span class="md-ellipsis">
      Code samples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#register-with-code-va" class="md-nav__link">
    <span class="md-ellipsis">
      Register with CODE VA
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Register with CODE VA">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#event-template" class="md-nav__link">
    <span class="md-ellipsis">
      Event Template
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#schema-evolution" class="md-nav__link">
    <span class="md-ellipsis">
      Schema Evolution
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#logs" class="md-nav__link">
    <span class="md-ellipsis">
      Logs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      Troubleshooting
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../environments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Environments
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../use-events/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Event Catalog
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../offboard/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Offboarding
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../terminology/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Terminology
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../get-support/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Event Bus Contact and Support
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="producing-events"><strong>Producing Events</strong></h1>
<h2 id="whats-a-producer"><strong>What's a producer?</strong></h2>
<p>A producer is an application designed to generate messages or events within an event-driven system. In the context of the Enterprise Event Bus, which aims to expose streams of events known as topics, producers play a crucial role. Producing teams have access to, or knowledge about, important data changes in the VA ecosystem and can send events to specific topics on the Event Bus. Find out how to view a list of currently available topics by visiting our <a href="../use-events/">Event Catalog page</a>.</p>
<p>As producers are responsible for defining topics and their contents, they will work with the Event Bus Team to determine configuration settings such as the number of topic partitions, event versioning, and event retention rules. The content below outlines the steps needed to start producing events. To learn more about the components and processes involved in event-based systems, please visit our <a href="../intro-to-eda/">How Event Bus Implements Event-Driven Architecture page</a>.</p>
<h2 id="steps-to-become-a-producer"><strong>Steps to become a producer</strong></h2>
<h3 id="define-the-event-or-topic"><strong>Define the event or topic</strong></h3>
<p>The first step in producing an event is to <a href="../get-support/">contact the Enterprise Event Bus Team</a> and express your interest in contributing an event stream. An ideal event stream represents a business event within the VA that would be of interest to multiple stakeholders and have a significant impact on Veterans. Examples of such events include changes to eligibility for benefits, milestones in the claims process, or updates to a Veteran's health record, such as new appointments, prescriptions, or lab results.</p>
<p>While it is not a requirement to have consumers identified from the start, in an ideal scenario the events would theoretically be meaningful to multiple, independent consumers. If you do have consumers in mind, reach out to them and engage in preliminary discussions about their needs, preferences, and timelines. You can find more information on consuming events on our <a href="../consume-events/">Consuming Events page</a>.</p>
<p>If there is a mutual interest to continue after the initial meeting, the Event Bus Team will create a one-page description of the proposed event topic, including details about the business context, event purpose, payload, and consumers. The partner team will review and provide feedback on the document and sign a Working Agreement and a Data Sharing Agreement.</p>
<h3 id="determine-if-you-need-an-esecc-request"><strong>Determine if you need an ESECC request</strong></h3>
<p>See the <a href="../administrative-requirements/#esecc">ESECC section on the Administrative Requirements page</a>.</p>
<h3 id="choose-configuration-settings-and-submit-onboarding-request"><strong>Choose configuration settings and submit onboarding request</strong></h3>
<p>Before creating a topic, you need to consider various Kafka settings. Producing teams must choose appropriate settings based on their specific use case and technical requirements. From a logistical perspective, the Event Bus Team will handle the initial creation of the topic using the Kafka CLI and make it available for production.</p>
<h4 id="number-of-partitions"><strong>Number of partitions</strong></h4>
<p>Partitions in Kafka serve as the primary unit of storage within a topic, with each partition containing a subset of events. Determining the number of partitions is crucial, as it has implications for storage, scalability, replication, and message movement. To learn more about reasonable defaults, and other partition-related concerns, read our <a href="https://github.com/department-of-veterans-affairs/VES/blob/master/research/Event%20Bus/Engineering/ADR/ADR%20Kafka%20Partitions.md">guidance on topics and partitions (must be part of VA GitHub organization to view)</a>.</p>
<h4 id="event-retention"><strong>Event retention</strong></h4>
<p>Event retention refers to how long an event exists within Kafka and remains available for consumption. This setting would be especially important to consumers who need to be prepared to handle missed events before they expire. For additional information and discussion, see the section about Retention in our <a href="https://github.com/department-of-veterans-affairs/VES/blob/master/research/Event%20Bus/Engineering/ADR/ADR%20event%20design.md#event-retention">Event Design Architectural Decision Record (must be part of VA GitHub organization to view)</a>.</p>
<h4 id="event-schema-and-event-registry"><strong>Event schema and event registry</strong></h4>
<p>The Event Bus utilizes the <a href="https://docs.confluent.io/platform/7.5/schema-registry/fundamentals/index.html#sr-key-concepts">Confluent Schema Registry</a> to store schemas and their versions. Avro is used to define the schema format. Producers must submit an event schema representing the event payload in Avro format as part of the onboarding process. Producers must also use <a href="https://avro.apache.org/">Apache Avro</a> to serialize data onto the Event Bus so that the event schema, and the data contract it represents, is enforced. Additionally, producers should consider event versioning, which involves planning how schemas will evolve. Event versions are governed by the compatibility type setting, which determines allowed schema changes and how consumers interact with different versions. For most producers, we recommend using the <code>BACKWARD</code> compatibility type. For more information, see our <a href="https://github.com/department-of-veterans-affairs/VES/blob/master/research/Event%20Bus/Engineering/ADR/ADR%20schema%20registry.md">article about the Confluent Schema Registry (must be part of VA GitHub organization to view)</a>, and our <a href="https://github.com/department-of-veterans-affairs/VES/blob/master/research/Event%20Bus/Engineering/ADR/ADR%20schema%20versioning.md">article about schema versioning (must be part of VA GitHub organization to view)</a>.</p>
<p>Once the producing team has communicated their decisions about the event schema, the Event Bus team will create the topic, along with the schema, and notify the producing team when everything is ready for use.</p>
<h3 id="set-up-authorization-and-authentication"><strong>Set up authorization and authentication</strong></h3>
<p>To produce messages to specific topics on the Event Bus, producers need to be authenticated and have the appropriate permissions. The Event Bus MSK cluster is only accessible from the VA Network, and we use AWS IAM (Identity and Access Management) Roles and Policies to control access to different resources. If your producing application is within the AWS environment, please inform us of the IAM Role(s) or IAM User(s) to which we should grant access. We will then set up the corresponding IAM Policies on our end and assign a named role for producers to authenticate with AWS MSK in their application code. If your producing application is outside of the AWS environment, we will request an IAM User to be created on your behalf. You will then be able to access the requested topic(s) using those credentials.</p>
<h3 id="connect-to-the-event-bus-in-the-development-environment"><strong>Connect to the Event Bus in the development environment</strong></h3>
<p>Once the authentication and authorization steps have been completed, you will be able to connect to the Event Bus MSK cluster using the Kafka bootstrap server addresses and port numbers available in the Event Catalog. The following ports are open for consumers and producers that are authenticated with AWS IAM:</p>
<ul>
<li>9098 (for access from AWS)</li>
<li>9198 (for access from outside of AWS)</li>
</ul>
<h3 id="develop-and-deploy-your-producer-application"><strong>Develop and deploy your producer application</strong></h3>
<p>Many programming languages and frameworks offer libraries designed to interact with Kafka. To ensure full compatibility with the Event Bus, your code needs to authenticate with the AWS MSK cluster using the assigned role provided during the onboarding process. Additionally, producers should reference the Confluent Schema Registry and use the created schema to serialize messages in Avro.</p>
<h4 id="client-properties"><strong>Client properties</strong></h4>
<p>To connect to the Event Bus, producers in <strong>all programming languages</strong> will need to set these properties:</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
<th>Description</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://kafka.apache.org/documentation/#producerconfigs_bootstrap.servers">bootstrap.servers</a></td>
<td>List of one or more Event Bus brokers. This will vary depending on the environment (dev, prod, etc.).</td>
<td>A list of host/port pairs to use for establishing the initial connection to the Kafka cluster.</td>
<td>Only one of the Event Bus brokers needs to be included in this list, but including more than one will ensure the application can start up if one of the brokers is down.</td>
</tr>
<tr>
<td><a href="https://kafka.apache.org/documentation/#producerconfigs_enable.idempotence">enable.idempotence</a></td>
<td>false</td>
<td>When set to 'true', the producer will ensure that exactly one copy of each message is written in the stream. If 'false', producer retries due to broker failures, etc., may write duplicates of the retried message in the stream.</td>
<td>If idempotence is a must-have for your application, then we will need to grant additional AWS permissions before you can set this to true.</td>
</tr>
<tr>
<td><a href="https://kafka.apache.org/documentation/#producerconfigs_sasl.mechanism">sasl.mechanism</a></td>
<td><code>OAUTHBEARER</code></td>
<td>SASL mechanism used for client connections.</td>
<td></td>
</tr>
<tr>
<td><a href="https://kafka.apache.org/documentation/#producerconfigs_security.protocol">security.protocol</a></td>
<td><code>SASL_SSL</code></td>
<td>Protocol used to communicate with brokers.</td>
<td></td>
</tr>
</tbody>
</table>
<p>Depending on the language client used, additional properties may also be needed for authorization and connecting to the schema registry. For example, these properties are required for <strong>Java clients</strong>:</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
<th>Description</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://kafka.apache.org/documentation/#producerconfigs_key.serializer">key.serializer</a></td>
<td><code>KafkaAvroSerializer</code></td>
<td>Serializer class for key.</td>
<td>All Event Bus records use an Avro schema, so this is required even if the key itself is a primitive type like <code>string</code> or <code>long</code>.</td>
</tr>
<tr>
<td><a href="https://kafka.apache.org/documentation/#producerconfigs_sasl.jaas.config">sasl.jaas.config</a></td>
<td><code>OAuthBearerLoginModule</code> and role settings. The role will vary for each producer.</td>
<td>JAAS login context parameters for SASL connections in the format used by JAAS configuration files.</td>
<td>See <a href="https://github.com/aws/aws-msk-iam-auth#specifying-an-aws-iam-role-for-a-client">specifying an AWS IAM role</a> for more information.</td>
</tr>
<tr>
<td><a href="https://kafka.apache.org/documentation/#producerconfigs_sasl.login.callback.handler.class">sasl.login.callback.handler.class</a></td>
<td><code>IAMOAuthBearerLoginCallbackHandler</code></td>
<td>The fully qualified name of a SASL login callback handler class.</td>
<td>See <a href="https://github.com/aws/aws-msk-iam-auth?tab=readme-ov-file#configuring-a-kafka-client-to-use-aws-iam-with-sasl-oauthbearer-mechanism">aws-msk-iam-auth</a> for more information.</td>
</tr>
<tr>
<td><a href="https://kafka.apache.org/documentation/#producerconfigs_sasl.client.callback.handler.class">sasl.client.callback.handler.class</a></td>
<td><code>IAMOAuthBearerLoginCallbackHandler</code></td>
<td>The fully qualified name of a SASL client callback handler class.</td>
<td>See <a href="https://github.com/aws/aws-msk-iam-auth?tab=readme-ov-file#configuring-a-kafka-client-to-use-aws-iam-with-sasl-oauthbearer-mechanism">aws-msk-iam-auth</a> for more information.</td>
</tr>
<tr>
<td><a href="https://kafka.apache.org/documentation/#producerconfigs_value.serializer">value.serializer</a></td>
<td><code>KafkaAvroSerializer</code></td>
<td>Serializer class for value.</td>
<td></td>
</tr>
<tr>
<td>auto.register.schemas</td>
<td><code>false</code></td>
<td>Specify if the serializer should attempt to register the schema with the Schema Registry.</td>
<td>If set to true, the producer will attempt to register a new schema rather than using an existing one in the registry. Since writes to the Event Bus schema registry are blocked for unauthorized applications, this will result in an error which prevents the producer from producing events.</td>
</tr>
<tr>
<td>schema.registry.url</td>
<td>Event Bus schema registry endpoint. This will vary depending on the environment (dev, prod, etc.).</td>
<td>Comma-separated list of URLs for Schema Registry instances that can be used to register or look up schemas.</td>
<td></td>
</tr>
<tr>
<td>use.latest.version</td>
<td><code>false</code> (this is the default value)</td>
<td>Flag that indicates if the latest schema version should be used for serialization.</td>
<td>Event Bus recommends setting this value to false to avoid issues when a new schema version is added to the schema registry.</td>
</tr>
<tr>
<td>use.schema.id</td>
<td>ID of the schema in the Event Bus schema registry. This will vary depending on the environment. The Event Bus team will supply this value.</td>
<td>Integer ID that indicates which schema to use for serialization.</td>
<td>Event Bus recommends setting this value to be specific about which schema version is used to write events and to reduce ambiguity.</td>
</tr>
<tr>
<td>latest.cache.ttl.sec</td>
<td><code>-1</code> (this is the default value)</td>
<td>This sets a TTL for the schema registry cache. <code>-1</code> indicates that the cache has no TTL.</td>
<td>Event Bus recommends using the default of <code>-1</code> for this value. Schema versions do not change once they are registered. This will decrease the application's dependency on the schema registry.</td>
</tr>
</tbody>
</table>
<h4 id="code-samples"><strong>Code samples</strong></h4>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Expand the sections below to see producer code examples in Java and Ruby. To see the samples in context, please check out the <a href="https://github.com/department-of-veterans-affairs/ves-event-bus-sample-code"><code>ves-event-bus-sample-code</code> repository (must be part of VA GitHub organization to view)</a>.</p>
</div>
<details class="example">
<summary>Java Producer</summary>
<p><div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">gov.va.eventbus.example</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">io.confluent.kafka.serializers.KafkaAvroDeserializerConfig</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io.confluent.kafka.serializers.KafkaAvroSerializer</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io.confluent.kafka.serializers.KafkaAvroSerializerConfig</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Properties</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.avro.specific.SpecificRecord</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.kafka.clients.CommonClientConfigs</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.kafka.clients.producer.KafkaProducer</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.kafka.clients.producer.ProducerConfig</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.kafka.clients.producer.ProducerRecord</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.kafka.common.config.SaslConfigs</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.kafka.common.config.SslConfigs</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.slf4j.Logger</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.slf4j.LoggerFactory</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TestProducer</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Runnable</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Logger</span><span class="w"> </span><span class="n">LOG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LoggerFactory</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">TestProducer</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Producer values</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">TOPIC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;test&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">EB_BOOTSTRAP_SERVERS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">getenv</span><span class="p">(</span><span class="s">&quot;EB_BOOTSTRAP_SERVERS&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">EB_SECURITY_PROTOCOL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">getenv</span><span class="p">(</span><span class="s">&quot;EB_SECURITY_PROTOCOL&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">SCHEMA_REGISTRY_URL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">getenv</span><span class="p">(</span><span class="s">&quot;SCHEMA_REGISTRY_URL&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">AWS_ROLE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">getenv</span><span class="p">(</span><span class="s">&quot;AWS_ROLE&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">KafkaProducer</span><span class="o">&lt;</span><span class="n">Long</span><span class="p">,</span><span class="w"> </span><span class="n">SpecificRecord</span><span class="o">&gt;</span><span class="w"> </span><span class="n">producer</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">TestProducer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">producer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createProducer</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">sequenceNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">sequenceNumber</span><span class="o">++</span><span class="p">;</span>
<span class="w">                </span><span class="c1">// The messages in the topic adhere to a User schema</span>
<span class="w">                </span><span class="kd">var</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">User</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">()</span>
<span class="w">                        </span><span class="p">.</span><span class="na">setName</span><span class="p">(</span><span class="s">&quot;Newbie&quot;</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="na">setCompany</span><span class="p">(</span><span class="s">&quot;Ad Hoc&quot;</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="na">setDateOfBirth</span><span class="p">(</span><span class="n">LocalDate</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">26</span><span class="p">))</span>
<span class="w">                        </span><span class="p">.</span><span class="na">setSequenceNumber</span><span class="p">(</span><span class="n">sequenceNumber</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="w">                </span><span class="c1">// Create producer record</span>
<span class="w">                </span><span class="n">ProducerRecord</span><span class="o">&lt;</span><span class="n">Long</span><span class="p">,</span><span class="w"> </span><span class="n">SpecificRecord</span><span class="o">&gt;</span><span class="w"> </span><span class="n">producerRecord</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ProducerRecord</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">TOPIC</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">);</span>

<span class="w">                </span><span class="c1">// Send the record to the Kafka topic</span>
<span class="w">                </span><span class="n">producer</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">producerRecord</span><span class="p">);</span>
<span class="w">                </span><span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">LOG</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;An exception occurred while producing messages&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">producer</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">KafkaProducer</span><span class="o">&lt;</span><span class="n">Long</span><span class="p">,</span><span class="w"> </span><span class="n">SpecificRecord</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">createProducer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Properties</span><span class="w"> </span><span class="n">props</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Properties</span><span class="p">();</span>

<span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ProducerConfig</span><span class="p">.</span><span class="na">BOOTSTRAP_SERVERS_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="n">EB_BOOTSTRAP_SERVERS</span><span class="p">);</span>
<span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ProducerConfig</span><span class="p">.</span><span class="na">KEY_SERIALIZER_CLASS_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="n">KafkaAvroSerializer</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span>
<span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ProducerConfig</span><span class="p">.</span><span class="na">VALUE_SERIALIZER_CLASS_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="n">KafkaAvroSerializer</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span>
<span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">KafkaAvroSerializerConfig</span><span class="p">.</span><span class="na">SCHEMA_REGISTRY_URL_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="n">SCHEMA_REGISTRY_URL</span><span class="p">);</span>
<span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">KafkaAvroSerializerConfig</span><span class="p">.</span><span class="na">AUTO_REGISTER_SCHEMAS</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<span class="w">        </span><span class="n">producerProps</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">KafkaAvroSerializerConfig</span><span class="p">.</span><span class="na">USE_LATEST_VERSION</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span>
<span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ProducerConfig</span><span class="p">.</span><span class="na">ENABLE_IDEMPOTENCE_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// * See note below about SCHEMA_ID_FROM_EB</span>
<span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">ProducerConfig</span><span class="p">.</span><span class="na">USE_SCHEMA_ID</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="n">SCHEMA_ID_FROM_EB</span><span class="o">&gt;</span><span class="p">);</span><span class="w"> </span>

<span class="w">        </span><span class="c1">// Use SASL_SSL in production but PLAINTEXT in local environment</span>
<span class="w">        </span><span class="c1">// w/docker_compose</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;SASL_SSL&quot;</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">EB_SECURITY_PROTOCOL</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">CommonClientConfigs</span><span class="p">.</span><span class="na">SECURITY_PROTOCOL_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="n">EB_SECURITY_PROTOCOL</span><span class="p">);</span>
<span class="w">            </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">SslConfigs</span><span class="p">.</span><span class="na">SSL_TRUSTSTORE_LOCATION_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/tmp/kafka.client.truststore.jks&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">SaslConfigs</span><span class="p">.</span><span class="na">SASL_MECHANISM</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;OAUTHBEARER&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">SaslConfigs</span><span class="p">.</span><span class="na">SASL_JAAS_CONFIG</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;org.apache.kafka.common.security.oauthbearer.OAuthBearerLoginModule required awsRoleArn=\&quot;&quot;</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="n">AWS_ROLE</span><span class="w"> </span><span class="c1">// use the role name provided to you</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;\&quot; awsStsRegion=\&quot;us-gov-west-1\&quot;;&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">SaslConfigs</span><span class="p">.</span><span class="na">SASL_LOGIN_CALLBACK_HANDLER_CLASS</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;software.amazon.msk.auth.iam.IAMOAuthBearerLoginCallbackHandler&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">SaslConfigs</span><span class="p">.</span><span class="na">SASL_CLIENT_CALLBACK_HANDLER_CLASS</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;software.amazon.msk.auth.iam.IAMOAuthBearerLoginCallbackHandler&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="s">&quot;PLAINTEXT&quot;</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">EB_SECURITY_PROTOCOL</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">LOG</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;Unknown EB_SECURITY_PROTOCOL &#39;{}&#39;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">EB_SECURITY_PROTOCOL</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">KafkaProducer</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">props</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
*<code>SCHEMA_ID_FROM_EB</code>: Schema ID is an integer ID assigned by the Schema Registry.
The Event Bus Team will provide you this value.  Reach out to them when you are ready.</p>
</details>
<details class="example">
<summary>Ruby Producer</summary>
<div class="highlight"><pre><span></span><code><span class="nb">require</span><span class="w"> </span><span class="s1">&#39;logger&#39;</span>
<span class="nb">require</span><span class="w"> </span><span class="s1">&#39;rdkafka&#39;</span>
<span class="nb">require</span><span class="w"> </span><span class="s1">&#39;avro_turf/messaging&#39;</span>
<span class="n">require_relative</span><span class="w"> </span><span class="s1">&#39;oauth_token_refresher&#39;</span>

<span class="n">logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">Logger</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">STDOUT</span><span class="p">)</span>

<span class="vi">@producers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">refresh_token</span><span class="p">(</span><span class="n">_config</span><span class="p">,</span><span class="w"> </span><span class="n">producer_name</span><span class="p">)</span>
<span class="w">    </span><span class="n">producer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="vi">@producers</span><span class="o">[</span><span class="n">producer_name</span><span class="o">]</span>
<span class="w">    </span><span class="no">OAuthTokenRefresher</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">refresh_token</span><span class="p">(</span><span class="n">producer</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">security_protocol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;SECURITY_PROTOCOL&#39;</span><span class="o">]</span>

<span class="n">properties</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s1">&#39;bootstrap.servers&#39;</span><span class="p">:</span><span class="w"> </span><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;KAFKA_HOST&#39;</span><span class="o">]</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;security.protocol&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">security_protocol</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;enable.idempotence&#39;</span><span class="p">:</span><span class="w"> </span><span class="kp">false</span>
<span class="p">}</span>

<span class="k">if</span><span class="w"> </span><span class="s1">&#39;SASL_SSL&#39;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">security_protocol</span><span class="o">.</span><span class="n">upcase</span>
<span class="w">    </span><span class="n">properties</span><span class="o">[</span><span class="s1">&#39;sasl.mechanisms&#39;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;OAUTHBEARER&#39;</span>
<span class="w">    </span><span class="no">Rdkafka</span><span class="o">::</span><span class="no">Config</span><span class="o">.</span><span class="n">oauthbearer_token_refresh_callback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">method</span><span class="p">(</span><span class="ss">:refresh_token</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">producer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">Rdkafka</span><span class="o">::</span><span class="no">Config</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span><span class="o">.</span><span class="n">producer</span><span class="p">(</span><span class="ss">native_kafka_auto_start</span><span class="p">:</span><span class="w"> </span><span class="kp">false</span><span class="p">)</span>
<span class="vi">@producers</span><span class="o">[</span><span class="n">producer</span><span class="o">.</span><span class="n">name</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">producer</span>
<span class="n">producer</span><span class="o">.</span><span class="n">start</span>

<span class="n">avro</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">AvroTurf</span><span class="o">::</span><span class="no">Messaging</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">registry_url</span><span class="p">:</span><span class="w"> </span><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;SCHEMA_REGISTRY_URL&#39;</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="ss">registry_path_prefix</span><span class="p">:</span><span class="w"> </span><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;SCHEMA_REGISTRY_PATH_PREFIX&#39;</span><span class="o">]</span><span class="p">)</span>

<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="w"> </span><span class="s2">&quot;Running producer&quot;</span>
<span class="k">while</span><span class="w"> </span><span class="kp">true</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="n">payload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">avro</span><span class="o">.</span><span class="n">encode</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;John Smith&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;appointment_time&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;</span><span class="si">#{</span><span class="no">DateTime</span><span class="o">.</span><span class="n">now</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">},</span><span class="w"> </span><span class="ss">subject</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;appointments-value&#39;</span><span class="p">,</span><span class="w"> </span><span class="ss">version</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="n">delivery_handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">producer</span><span class="o">.</span><span class="n">produce</span><span class="p">(</span><span class="ss">topic</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;appointments&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">payload</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">)</span>
<span class="w">    </span><span class="n">delivery_handle</span><span class="o">.</span><span class="n">wait</span>
<span class="w">    </span><span class="nb">sleep</span><span class="w"> </span><span class="mi">15</span>
<span class="k">end</span>
</code></pre></div>
</details>
<h3 id="register-with-code-va"><strong>Register with CODE VA</strong></h3>
<p><a href="https://code.va.gov/">CODE VA (must be on VA network to view)</a> is a software catalog that houses information about software entities from across VA. Once you have your producer application up and running, it's important to register with the catalog to ensure that both current and future consumers can discover your event and access its details.</p>
<p>In Backstage, entities represent software components or resources that share a common data shape and semantics. While there are several built-in entities, we have specifically created a custom entity called "Event" for the Event Bus.</p>
<p>To register your event with CODE VA:</p>
<ol>
<li>Create a file named <code>catalog-info.yaml</code> at the root of your source code repository.</li>
<li>Populate the <code>catalog-info.yaml</code> file with an <code>Event</code> Backstage entity based on the template below.</li>
<li>Once your <code>catalog-info.yaml</code> file has been committed it will be automatically processed and the event will be viewable on <a href="https://code.va.gov/">CODE VA (must be on the VA network to view)</a> within a few hours. If you would like the event to display quicker, follow the <a href="https://backstage.io/docs/features/software-catalog/#adding-components-to-the-catalog">Backstage documentation on the default method for adding entries to the catalog</a>.</li>
</ol>
<h4 id="event-template"><strong>Event Template</strong></h4>
<div class="copy highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">backstage.io/v1alpha1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Event</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">event-name</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Event description.</span>
<span class="w">    </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Event Name</span>
<span class="w">    </span><span class="nt">links</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://sample-slack-link.com</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">title</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Event Producer Slack Channel</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://sample-link.com</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">title</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Event Documentation</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">event</span>
<span class="w">    </span><span class="nt">lifecycle</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<span class="w">    </span><span class="nt">domain</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">health</span>
<span class="w">    </span><span class="nt">sourceSystems</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">systemName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Source System Name</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">teamName</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Source System Owning Team</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">productOwner</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Source System Product Owner</span>
<span class="w">    </span><span class="nt">topics</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">topic</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">topic_name</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">environment</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">development</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">topic</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">topic_name</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">environment</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<span class="w">    </span><span class="nt">forwarders</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">systemName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Forwarding System</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">teamName</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Forwarding System Owning Team</span>
<span class="w">    </span><span class="nt">retention</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span>
</code></pre></div>
<p>Here is some additional information on the individual fields:</p>
<ul>
<li><strong>apiVersion</strong> [required]: This value must be set to <code>backstage.io/v1alpha1</code>.</li>
<li><strong>kind</strong> [required]: This value must be set to <code>Event</code>.</li>
<li><strong>metadata</strong> [required]: A structure that contains information about the entity itself. The <code>metadata</code> structure includes the following properties.<ul>
<li><strong>name</strong> [required]: A machine-readable name for the event. This value will be used in CODE VA urls, so it should be all lowercase and use hyphens as separators.    </li>
<li><strong>description</strong> [required]: A concise, high-level description of the event and the data it provides.</li>
<li><strong>title</strong> [required]: A human-readable representation of the <code>name</code> to be used in CODE VA user interfaces.</li>
<li><strong>links</strong> [optional]: A list of links related to the event. Each link consists of a <code>url</code> and a <code>title</code>.<ul>
<li><strong>url</strong> [required]: The external url that will be opened when the link is clicked.</li>
<li><strong>title</strong> [required]: Display text for the link.</li>
</ul>
</li>
</ul>
</li>
<li><strong>spec</strong> [required]: A structure that contains information about the event a producer will be emitting. The <code>spec</code> structure includes the following properties.<ul>
<li><strong>type</strong> [required]: This value must be set to <code>event</code>.</li>
<li><strong>lifecycle</strong> [required]: The current development status for the event. This value must be set to: <code>experimental</code>, <code>development</code>, <code>production</code>, or <code>deprecated</code>.</li>
<li><strong>removalDate</strong> [optional]: This property should only be set if <code>lifecycle</code> is set to <code>deprecated</code>. This property specifies the date that a deprecated event will be removed.</li>
<li><strong>domain</strong> [required]: The VA domain in which a particular event exists. Possible values might be: <code>claims status</code>, <code>health</code>, <code>appointments</code>, <code>benefits</code>, etc.</li>
<li><strong>sourceSystems</strong> [required]: An array of objects that contain information about the sources of this event. Each source system will contain the following fields.<ul>
<li><strong>systemName</strong> [required]: The name of the system that sources this event.</li>
<li><strong>teamName</strong> [required]: The name of the team that owns this system.</li>
<li><strong>productOwner</strong> [required]: OCTODE/VA PO embedded on the team that owns this system.</li>
</ul>
</li>
<li><strong>topics</strong> [required]: An array of objects that contain information about the Kafka topics these events will be published to. The example above shows a topic for the development and production environments. Each topic will contain the following fields.<ul>
<li><strong>topic</strong> [required]: The name of the topic.</li>
<li><strong>environment</strong> [required]: The environment this topic is available in. This value must be set to <code>development</code> or <code>production</code>.</li>
</ul>
</li>
<li><strong>forwarders</strong> [optional]: An array of objects that contain information about systems that forward this event. This property should be used if there is a system sitting in between the source data store and the Event Bus that mutates data before an event is published. Each forwarder will contain the following fields.<ul>
<li><strong>systemName</strong> [required]: The name of the system that forwards this event.</li>
<li><strong>teamName</strong> [required]: The name of the team that owns this forwarding system.</li>
</ul>
</li>
<li><strong>retention</strong> [optional]: This value represents the number of days that each event is retained for. It should be set to an integer. This property only needs to be set if your topic has a custom retention policy. If it is not set, the default of 7 days will be displayed.</li>
</ul>
</li>
</ul>
<p>The <code>catalog.yaml</code> file will be validated against <a href="https://github.com/department-of-veterans-affairs/ves-event-bus-backstage-plugins/blob/main/plugins/event-kind-backend/src/schema/Event.schema.json">this JSON schema (must be part of VA GitHub organization to view)</a>. The required <code>spec.schema</code>, <code>spec.schemaCompatibilityMode</code>, and <code>spec.topics.brokerAddresses</code> fields included in this JSON schema will be auto-populated and should not be included in the <code>catalog-info.yaml</code> file. The optional <code>spec.averageDailyEvents</code> field will also be auto-populated and should not be included in the <code>catalog-info.yaml</code> file.</p>
<h2 id="schema-evolution"><strong>Schema Evolution</strong></h2>
<p>Eventually the schema of an event may evolve. After a new version of the schema is added to the schema registry, consumers will need to update their applications to handle the new schema version before producers update to produce events using the new schema. The Event Bus team will coordinate these updates with producers and consumers.</p>
<h2 id="logs"><strong>Logs</strong></h2>
<p>Logs are stored within a LightHouse Delivery Infrastructure (LHDI) AWS S3 bucket. Only LHDI admins with AWS access can access this bucket and its content. Although producers and consumers will not have access to the S3 bucket directly, logs are available via <a href="https://lighthousedi.ddog-gov.com/">LHDI's Datadog instance (must have VA LightHouseDI DataDog access to view)</a>.</p>
<p>Datadog is a monitoring and analytics tool that is used within the VA. LHDI team members are admins within the Datadog space where the Event Bus metrics and logs are available. To request access to Datadog, complete the HelpDesk form on the ServiceNow Portal at <a href="https://gcc02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fyourit.va.gov%2Fva%3Fid%3Dsc_cat_item%26sys_id%3D4cdf488b1ba4fcd412979796bc4bcb74&amp;data=05%7C01%7C%7Ccb701e4e7fc944b6041308dbeacea9aa%7Ce95f1b23abaf45ee821db7ab251ab3bf%7C0%7C0%7C638361945550254440%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=sJfq3j8vnXwdtuQrfY%2FBaRttaqyOpKA6X17O8TMK9ug%3D&amp;reserved=0">ECC (Enterprise Command Center) Monitoring Services - your IT Service Portal (must be on the VA network to view)</a>.</p>
<h2 id="troubleshooting"><strong>Troubleshooting</strong></h2>
<p>If you have questions or run into difficulties with any of these steps, please <a href="../get-support/">contact the Enterprise Event Bus Team</a>.</p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../consume-events/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Consuming Events">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Consuming Events
              </div>
            </div>
          </a>
        
        
          
          <a href="../environments/" class="md-footer__link md-footer__link--next" aria-label="Next: Environments">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Environments
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.footer", "toc.integrate"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>